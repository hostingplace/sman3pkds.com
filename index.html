<!DOCTYPE html>

<html lang="id">
  <head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <title>PKDS - Pangkalan Kelengkapan Data Siswa</title>
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
      rel="stylesheet"
    />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
      /* CSS tetap sama seperti sebelumnya - tidak ada perubahan pada styling */
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      }

      :root {
        --primary: #1a6dcc;
        --primary-dark: #0d4a9e;
        --secondary: #2c3e50;
        --light: #f8f9fa;
        --gray: #e9ecef;
        --success: #28a745;
        --danger: #dc3545;
        --warning: #ffc107;
        --shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        --shadow-hover: 0 6px 15px rgba(0, 0, 0, 0.12);
      }

      body {
        background-color: #f0f2f5;
        color: var(--secondary);
        line-height: 1.6;
        overflow-x: hidden;
      }

      /* Login Styles */
      .login-container {
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 100vh;
        background: linear-gradient(
          135deg,
          var(--primary) 0%,
          var(--primary-dark) 100%
        );
        padding: 20px;
        position: relative;
        overflow: hidden;
      }

      .login-container::before {
        content: "";
        position: absolute;
        top: -50%;
        left: -50%;
        width: 200%;
        height: 200%;
        background: radial-gradient(
          circle,
          rgba(255, 255, 255, 0.1) 0%,
          rgba(255, 255, 255, 0) 70%
        );
        transform: rotate(30deg);
      }

      .login-card {
        background: white;
        border-radius: 16px;
        box-shadow: var(--shadow-hover);
        width: 100%;
        max-width: 480px;
        overflow: hidden;
        position: relative;
        z-index: 10;
      }

      .login-header {
        background: linear-gradient(
          120deg,
          var(--primary) 0%,
          var(--primary-dark) 100%
        );
        color: white;
        padding: 25px;
        text-align: center;
      }

      .login-header h1 {
        font-size: 28px;
        margin-bottom: 8px;
        font-weight: 700;
      }

      .login-header p {
        opacity: 0.9;
        font-size: 16px;
      }

      .login-body {
        padding: 30px;
      }

      .form-group {
        margin-bottom: 22px;
      }

      .form-group label {
        display: block;
        margin-bottom: 8px;
        font-weight: 600;
        color: var(--secondary);
      }

      .form-control {
        width: 100%;
        padding: 14px;
        border: 2px solid #ddd;
        border-radius: 10px;
        font-size: 16px;
        transition: all 0.3s;
      }

      .form-control:focus {
        border-color: var(--primary);
        outline: none;
        box-shadow: 0 0 0 3px rgba(26, 109, 204, 0.2);
      }

      .btn {
        display: inline-block;
        padding: 14px 28px;
        border: none;
        border-radius: 10px;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s;
        text-transform: uppercase;
        letter-spacing: 1px;
        position: relative;
        overflow: hidden;
      }

      .btn::after {
        content: "";
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: rgba(255, 255, 255, 0.2);
        transition: left 0.5s;
      }

      .btn:hover::after {
        left: 100%;
      }

      .btn-primary {
        background: linear-gradient(
          120deg,
          var(--primary) 0%,
          var(--primary-dark) 100%
        );
        color: white;
        width: 100%;
        box-shadow: 0 4px 8px rgba(26, 109, 204, 0.3);
      }

      .btn-primary:hover {
        background: linear-gradient(
          120deg,
          var(--primary-dark) 0%,
          var(--primary) 100%
        );
        transform: translateY(-2px);
        box-shadow: 0 6px 12px rgba(26, 109, 204, 0.4);
      }

      .btn-secondary {
        background: #6c757d;
        color: white;
        width: 100%;
      }

      .btn-secondary:hover {
        background: #5a6268;
        transform: translateY(-2px);
      }

      .btn-danger {
        background: var(--danger);
        color: white;
        width: 100%;
      }

      .btn-danger:hover {
        background: #c82333;
        transform: translateY(-2px);
      }

      .error-message {
        color: var(--danger);
        text-align: center;
        margin-top: 15px;
        font-weight: 600;
        display: none;
        animation: shake 0.5s;
      }

      @keyframes shake {
        0%,
        100% {
          transform: translateX(0);
        }
        25%,
        75% {
          transform: translateX(-5px);
        }
        50% {
          transform: translateX(5px);
        }
      }

      .notice-box {
        background: rgba(255, 255, 255, 0.15);
        border: 1px solid rgba(255, 255, 255, 0.3);
        border-radius: 10px;
        padding: 15px;
        margin: 20px 0;
        color: white;
        font-size: 15px;
        text-align: center;
        backdrop-filter: blur(5px);
      }

      .emergency-section {
        margin-top: 25px;
        padding-top: 20px;
        border-top: 1px dashed var(--gray);
      }

      .emergency-section h3 {
        color: var(--warning);
        margin-bottom: 10px;
        font-size: 18px;
      }

      /* App Styles */
      #app {
        display: none;
        flex-direction: column;
        min-height: 100vh;
      }

      /* Sticky Header Styles */
      .header {
        background: white;
        padding: 15px 30px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        box-shadow: var(--shadow);
        position: sticky;
        top: 0;
        z-index: 1000;
        width: 100%;
        transition: all 0.3s ease;
      }

      .header.scrolled {
        box-shadow: var(--shadow-hover);
        padding: 12px 30px;
      }

      .logo {
        display: flex;
        align-items: center;
        gap: 12px;
        font-weight: 700;
        font-size: 18px;
        color: var(--primary);
      }

      .logo i {
        font-size: 24px;
      }

      .user-info {
        display: flex;
        align-items: center;
        gap: 15px;
      }

      .user-details {
        text-align: right;
      }

      .user-details h3 {
        font-size: 16px;
        color: var(--secondary);
        font-weight: 600;
      }

      .user-details p {
        font-size: 14px;
        color: #6c757d;
      }

      .sidebar {
        position: fixed;
        top: 70px; /* Adjusted for header height */
        left: 0;
        height: calc(100vh - 70px);
        width: 250px;
        background: linear-gradient(
          180deg,
          var(--primary) 0%,
          var(--primary-dark) 100%
        );
        color: white;
        padding: 25px 0 20px;
        z-index: 999;
        transition: all 0.3s;
      }

      .sidebar-menu {
        list-style: none;
        padding: 0 20px;
      }

      .sidebar-menu li {
        margin-bottom: 5px;
      }

      .sidebar-menu a {
        display: flex;
        align-items: center;
        gap: 14px;
        color: rgba(255, 255, 255, 0.85);
        text-decoration: none;
        padding: 14px 18px;
        border-radius: 12px;
        transition: all 0.3s;
        font-weight: 500;
        font-size: 15px;
      }

      .sidebar-menu a:hover,
      .sidebar-menu a.active {
        background: rgba(255, 255, 255, 0.15);
        color: white;
        transform: translateX(5px);
      }

      .sidebar-menu a i {
        font-size: 18px;
        width: 24px;
        text-align: center;
      }

      .content {
        margin-left: 250px;
        padding: 25px;
        padding-top: 95px; /* Extra padding to prevent content from being hidden under header */
        transition: all 0.3s;
        min-height: calc(100vh - 70px);
      }

      .section {
        display: none;
        animation: fadeIn 0.4s ease;
      }

      .section.active {
        display: block;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .card {
        background: white;
        border-radius: 16px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        padding: 25px;
        margin-bottom: 25px;
        transition: all 0.3s;
      }

      .card:hover {
        box-shadow: var(--shadow-hover);
      }

      .card-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
        padding-bottom: 15px;
        border-bottom: 1px solid var(--gray);
      }

      .card-title {
        font-size: 22px;
        color: var(--primary);
        font-weight: 700;
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .card-title i {
        font-size: 24px;
      }

      .stats-cards {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
      }

      .stat-card {
        background: white;
        border-radius: 16px;
        padding: 25px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        display: flex;
        align-items: center;
        justify-content: space-between;
        border-left: 5px solid var(--primary);
        transition: all 0.3s;
      }

      .stat-card:hover {
        transform: translateY(-5px);
        box-shadow: var(--shadow-hover);
      }

      .stat-card i {
        font-size: 32px;
        color: var(--primary);
        background: rgba(26, 109, 204, 0.1);
        width: 70px;
        height: 70px;
        border-radius: 16px;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .stat-content h3 {
        font-size: 18px;
        color: #6c757d;
        margin-bottom: 8px;
        font-weight: 600;
      }

      .stat-content p {
        font-size: 28px;
        font-weight: 700;
        color: var(--secondary);
      }

      .form-row {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
        margin-bottom: 25px;
      }

      .form-group label {
        font-weight: 600;
        margin-bottom: 8px;
        display: block;
        font-size: 15px;
      }

      .form-control {
        width: 100%;
        padding: 14px;
        border: 2px solid #ddd;
        border-radius: 10px;
        font-size: 16px;
      }

      .file-upload {
        border: 2px dashed #ddd;
        border-radius: 10px;
        padding: 25px;
        text-align: center;
        background: #f8f9fa;
        cursor: pointer;
        transition: all 0.3s;
      }

      .file-upload:hover {
        border-color: var(--primary);
        background: rgba(26, 109, 204, 0.05);
      }

      .file-upload i {
        font-size: 48px;
        color: var(--primary);
        margin-bottom: 10px;
      }

      .file-upload p {
        color: #6c757d;
        margin: 5px 0;
      }

      .file-preview {
        margin-top: 15px;
        padding: 15px;
        border: 1px solid #ddd;
        border-radius: 10px;
        background: #f9fbfd;
        display: none;
      }

      .file-preview.show {
        display: block;
        animation: fadeIn 0.3s;
      }

      .file-preview a {
        display: block;
        color: var(--primary);
        text-decoration: none;
        margin: 8px 0;
        font-weight: 600;
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .file-preview a:hover {
        text-decoration: underline;
      }

      .table-responsive {
        overflow-x: auto;
      }

      table {
        width: 100%;
        border-collapse: collapse;
        min-width: 800px;
      }

      th,
      td {
        padding: 16px 20px;
        text-align: left;
        border-bottom: 1px solid #eee;
      }

      th {
        background: var(--primary);
        color: white;
        font-weight: 600;
        font-size: 15px;
        position: sticky;
        top: 25px; /* Header height + content padding-top */
        z-index: 10;
      }

      tr:hover {
        background: #f8f9fa;
      }

      .btn-action {
        padding: 8px 15px;
        border-radius: 8px;
        margin: 3px;
        font-size: 14px;
        display: inline-flex;
        align-items: center;
        gap: 5px;
        transition: all 0.2s;
      }

      .btn-action:hover {
        transform: translateY(-2px);
      }

      .btn-edit {
        background: var(--primary);
        color: white;
      }

      .btn-edit:hover {
        background: var(--primary-dark);
      }

      .btn-preview {
        background: var(--success);
        color: white;
      }

      .btn-preview:hover {
        background: #218838;
      }

      .btn-delete {
        background: var(--danger);
        color: white;
      }

      .btn-delete:hover {
        background: #c82333;
      }

      .chart-container {
        height: 350px;
        margin: 30px 0;
        background: #f8f9fa;
        border-radius: 12px;
        padding: 15px;
      }

      .report-actions {
        display: flex;
        justify-content: flex-end;
        margin-top: 20px;
        gap: 15px;
      }

      .deadline-badge {
        background: linear-gradient(135deg, #e3f2fd, #bbdefb);
        color: var(--primary);
        padding: 10px 20px;
        border-radius: 12px;
        font-weight: 700;
        font-size: 16px;
        display: inline-block;
        margin-top: 10px;
      }

      .activity-item {
        display: flex;
        gap: 15px;
        padding: 18px 0;
        border-bottom: 1px solid #f1f3f5;
      }

      .activity-icon {
        background: #e3f2fd;
        color: var(--primary);
        width: 45px;
        height: 45px;
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        flex-shrink: 0;
      }

      .activity-icon i {
        font-size: 20px;
      }

      .activity-content h4 {
        font-size: 17px;
        margin-bottom: 5px;
        color: var(--secondary);
        font-weight: 600;
      }

      .activity-content p {
        color: #6c757d;
        font-size: 14px;
      }

      .activity-content time {
        font-size: 13px;
        color: #adb5bd;
        display: block;
        margin-top: 3px;
      }

      .logout-btn {
        background: none;
        border: none;
        color: rgba(255, 255, 255, 0.9);
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 12px;
        padding: 14px 18px;
        width: 100%;
        text-align: left;
        border-radius: 12px;
        transition: all 0.3s;
        font-weight: 500;
        font-size: 15px;
      }

      .logout-btn:hover {
        background: rgba(220, 53, 69, 0.2);
        color: white;
      }

      .logout-btn i {
        font-size: 18px;
      }

      /* Modal Styles */
      .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.6);
        z-index: 2000;
        align-items: center;
        justify-content: center;
        animation: fadeIn 0.3s;
      }

      .modal.active {
        display: flex;
      }

      .modal-content {
        background: white;
        border-radius: 16px;
        width: 90%;
        max-width: 900px;
        max-height: 90vh;
        overflow-y: auto;
        box-shadow: 0 15px 40px rgba(0, 0, 0, 0.25);
        position: relative;
        animation: slideUp 0.4s;
      }

      @keyframes slideUp {
        from {
          transform: translateY(50px);
          opacity: 0;
        }
        to {
          transform: translateY(0);
          opacity: 1;
        }
      }

      .modal-header {
        padding: 20px 25px;
        border-bottom: 1px solid var(--gray);
        display: flex;
        justify-content: space-between;
        align-items: center;
        background: linear-gradient(
          120deg,
          var(--primary) 0%,
          var(--primary-dark) 100%
        );
        color: white;
      }

      .modal-title {
        font-size: 20px;
        font-weight: 600;
      }

      .close-modal {
        background: none;
        border: none;
        color: white;
        font-size: 24px;
        cursor: pointer;
        width: 36px;
        height: 36px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.2s;
      }

      .close-modal:hover {
        background: rgba(255, 255, 255, 0.2);
      }

      .modal-body {
        padding: 25px;
      }

      .student-detail {
        margin-bottom: 20px;
      }

      .student-detail h4 {
        font-size: 16px;
        color: #6c757d;
        margin-bottom: 8px;
        font-weight: 600;
      }

      .student-detail p {
        font-size: 18px;
        font-weight: 600;
        color: var(--secondary);
      }

      .pdf-container {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
        gap: 20px;
        margin-top: 20px;
      }

      .pdf-viewer {
        border: 1px solid #ddd;
        border-radius: 12px;
        overflow: hidden;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.05);
      }

      .pdf-viewer h5 {
        padding: 12px 15px;
        background: var(--primary);
        color: white;
        margin: 0;
        font-size: 16px;
      }

      .pdf-iframe {
        width: 100%;
        height: 400px;
        border: none;
      }

      /* Notification Styles */
      .notification {
        position: fixed;
        top: 20px;
        right: 20px;
        padding: 15px 25px;
        border-radius: 10px;
        color: white;
        font-weight: 600;
        z-index: 3000;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.15);
        transform: translateX(400px);
        transition: transform 0.3s ease;
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .notification.show {
        transform: translateX(0);
      }

      .notification.success {
        background: var(--success);
      }

      .notification.error {
        background: var(--danger);
      }

      /* Responsive Styles */
      @media (max-width: 1100px) {
        .content {
          margin-left: 80px;
        }

        .sidebar {
          width: 80px;
          overflow: hidden;
        }

        .sidebar:hover {
          width: 250px;
        }

        .sidebar-menu a span {
          display: none;
        }

        .sidebar:hover .sidebar-menu a span {
          display: inline;
        }

        .user-details span,
        .user-details p {
          display: none;
        }

        .sidebar:hover .user-details span,
        .sidebar:hover .user-details p {
          display: block;
        }
      }

      @media (max-width: 992px) {
        .pdf-container {
          grid-template-columns: 1fr;
        }
      }

      @media (max-width: 768px) {
        .header {
          padding: 12px 15px;
        }

        .logo span {
          font-size: 16px;
        }

        .user-details h3,
        .user-details p {
          font-size: 13px;
        }

        .content {
          margin-left: 0;
          padding-top: 90px;
        }

        .sidebar {
          left: -250px;
          top: 70px;
          height: calc(100vh - 70px);
        }

        .sidebar.active {
          left: 0;
        }

        .mobile-toggle {
          display: block;
        }

        .stats-cards {
          grid-template-columns: 1fr;
        }
      }

      @media (max-width: 576px) {
        .login-card {
          margin: 15px;
        }

        .form-row {
          grid-template-columns: 1fr;
        }

        .report-actions {
          flex-direction: column;
        }

        .btn {
          width: 100%;
        }
      }

      /* Additional UI Elements */
      .timeline {
        position: relative;
        padding-left: 30px;
        margin: 25px 0;
      }

      .timeline::before {
        content: "";
        position: absolute;
        left: 8px;
        top: 10px;
        height: calc(100% - 10px);
        width: 2px;
        background: var(--primary);
      }

      .timeline-item {
        position: relative;
        margin-bottom: 30px;
      }

      .timeline-item:last-child {
        margin-bottom: 0;
      }

      .timeline-item::before {
        content: "";
        position: absolute;
        left: -30px;
        top: 8px;
        width: 16px;
        height: 16px;
        border-radius: 50%;
        background: var(--primary);
        border: 3px solid white;
        box-shadow: 0 0 0 2px var(--primary);
      }

      .timeline-content {
        background: white;
        padding: 15px;
        border-radius: 10px;
        box-shadow: 0 3px 10px rgba(0, 0, 0, 0.08);
      }

      .timeline-date {
        font-weight: 600;
        color: var(--primary);
        margin-bottom: 5px;
      }
    </style>
  </head>
  <body>
    <!-- Notification Element -->
    <div class="notification success" id="success-notification">
      <i class="fas fa-check-circle"></i>
      <span>Data siswa berhasil disimpan!</span>
    </div>
    <div class="notification error" id="error-notification">
      <i class="fas fa-exclamation-circle"></i>
      <span>Terjadi kesalahan!</span>
    </div>
    <!-- Login Section -->
    <div class="login-container" id="login-section">
      <div class="login-card">
        <div class="login-header">
          <h1><i class="fas fa-school"></i> PKDS Admin</h1>
          <p>Sistem Pengelolaan Data Siswa</p>
        </div>
        <div class="login-body">
          <div class="notice-box">
            <strong
              >Pengisian Data PKDS dibuka mulai 7 November 2025 hingga 30
              November 2025.</strong
            >
          </div>
          <div class="form-group">
            <label for="username">Username</label>
            <input
              class="form-control"
              id="username"
              placeholder="Masukkan username"
              type="text"
              value="admin"
            />
          </div>
          <div class="form-group">
            <label for="password">Password</label>
            <input
              class="form-control"
              id="password"
              placeholder="Masukkan password"
              type="password"
              value="12345"
            />
          </div>
          <div class="error-message" id="error-message">
            Username atau password salah!
          </div>
          <button class="btn btn-primary" id="login-btn">
            <i class="fas fa-sign-in-alt"></i> Masuk
          </button>
          <div class="emergency-section">
            <p>
              Jika diluar waktu operasional, silakan upload surat pembukaan
              kondisi tertentu:
            </p>
            <div class="form-group">
              <label for="emergency-file">File Bukti Darurat (PDF)</label>
              <input
                accept=".pdf"
                class="form-control"
                id="emergency-file"
                type="file"
              />
            </div>
            <button class="btn btn-secondary" id="emergency-login-btn">
              <i class="fas fa-file-medical"></i> Login Darurat
            </button>
          </div>
        </div>
      </div>
    </div>
    <!-- Preview Modal -->
    <div class="modal" id="preview-modal">
      <div class="modal-content">
        <div class="modal-header">
          <h3 class="modal-title">
            <i class="fas fa-user-graduate"></i> Detail Siswa
          </h3>
          <button class="close-modal" id="close-preview-modal">Ã—</button>
        </div>
        <div class="modal-body" id="preview-content">
          <!-- Content will be loaded by JavaScript -->
        </div>
      </div>
    </div>
    <!-- Main Application -->
    <div id="app">
      <div class="header">
        <div class="logo">
          <i class="fas fa-school"></i>
          <span>PKDS - SMAN 3 Bulukumba</span>
        </div>
        <div class="user-info">
          <div class="user-details">
            <h3>sman 3 bulukumba</h3>
            <p>Administrator</p>
          </div>
          <div class="user-avatar">
            <i
              class="fas fa-user-circle"
              style="font-size: 36px; color: var(--primary)"
            ></i>
          </div>
        </div>
      </div>
      <div class="sidebar">
        <ul class="sidebar-menu">
          <li>
            <a class="menu-link active" data-section="dashboard" href="#"
              ><i class="fas fa-tachometer-alt"></i> <span>Dashboard</span></a
            >
          </li>
          <li>
            <a class="menu-link" data-section="input-data" href="#"
              ><i class="fas fa-plus-circle"></i> <span>Input Data</span></a
            >
          </li>
          <li>
            <a class="menu-link" data-section="data-siswa" href="#"
              ><i class="fas fa-users"></i> <span>Data Siswa</span></a
            >
          </li>
          <li>
            <a class="menu-link" data-section="laporan" href="#"
              ><i class="fas fa-chart-pie"></i> <span>Laporan</span></a
            >
          </li>
          <li>
            <a class="menu-link" data-section="pengaturan" href="#"
              ><i class="fas fa-cog"></i> <span>Pengaturan</span></a
            >
          </li>
          <li>
            <button class="logout-btn" id="logout-btn">
              <i class="fas fa-sign-out-alt"></i> <span>Logout</span>
            </button>
          </li>
        </ul>
      </div>
      <div class="content">
        <!-- Dashboard Section -->
        <div class="section active" id="dashboard">
          <div class="stats-cards">
            <div class="stat-card">
              <div class="stat-content">
                <h3>Total Siswa</h3>
                <p id="total-siswa">0</p>
              </div>
              <i class="fas fa-users"></i>
            </div>
            <div class="stat-card">
              <div class="stat-content">
                <h3>PKDS Terekam</h3>
                <p id="pkds-terekam">0</p>
              </div>
              <i class="fas fa-check-circle"></i>
            </div>
            <div class="stat-card">
              <div class="stat-content">
                <h3>Batas Waktu</h3>
                <p class="deadline-badge" id="batas-waktu">31 Desember 2025</p>
              </div>
              <i class="fas fa-calendar-alt"></i>
            </div>
          </div>
          <div class="card">
            <div class="card-header">
              <h2 class="card-title">
                <i class="fas fa-history"></i> Aktivitas Terakhir
              </h2>
            </div>
            <div class="activity-list" id="activity-list">
              <div class="activity-item">
                <div class="activity-icon">
                  <i class="fas fa-user-plus"></i>
                </div>
                <div class="activity-content">
                  <h4>Penambahan Data Siswa</h4>
                  <p>2 siswa baru ditambahkan oleh Admin</p>
                  <time>10 November 2025, 14:30</time>
                </div>
              </div>
              <div class="activity-item">
                <div class="activity-icon">
                  <i class="fas fa-file-upload"></i>
                </div>
                <div class="activity-content">
                  <h4>Unggah Dokumen</h4>
                  <p>Dokumen PKDS untuk 5 siswa berhasil diunggah</p>
                  <time>9 November 2025, 16:45</time>
                </div>
              </div>
              <div class="activity-item">
                <div class="activity-icon">
                  <i class="fas fa-sync"></i>
                </div>
                <div class="activity-content">
                  <h4>Pembaruan Sistem</h4>
                  <p>Sistem PKDS diperbarui ke versi 2.1.0</p>
                  <time>7 November 2025, 09:15</time>
                </div>
              </div>
            </div>
          </div>
          <div class="card">
            <div class="card-header">
              <h2 class="card-title">
                <i class="fas fa-clock"></i> Timeline Pengisian PKDS
              </h2>
            </div>
            <div class="timeline">
              <div class="timeline-item">
                <div class="timeline-content">
                  <div class="timeline-date">7 November 2025</div>
                  <p>Pembukaan pengisian data PKDS untuk semester ganjil</p>
                </div>
              </div>
              <div class="timeline-item">
                <div class="timeline-content">
                  <div class="timeline-date">25 November 2025</div>
                  <p>Batas akhir pengumpulan dokumen bukti diterima</p>
                </div>
              </div>
              <div class="timeline-item">
                <div class="timeline-content">
                  <div class="timeline-date">30 November 2025</div>
                  <p>PENUTUPAN sistem PKDS untuk semester ini</p>
                </div>
              </div>
            </div>
          </div>
        </div>
        <!-- Input Data Section -->
        <div class="section" id="input-data">
          <div class="card">
            <div class="card-header">
              <h2 class="card-title" id="form-title">
                <i class="fas fa-edit"></i> Input Data Siswa
              </h2>
              <button
                class="btn btn-secondary"
                id="back-to-list-btn"
                style="display: none"
              >
                <i class="fas fa-arrow-left"></i> Kembali ke Daftar
              </button>
            </div>
            <form id="student-form">
              <input id="edit-id" type="hidden" />
              <div class="form-row">
                <div class="form-group">
                  <label for="nama">Nama Lengkap</label>
                  <input
                    class="form-control"
                    id="nama"
                    required=""
                    type="text"
                  />
                </div>
                <div class="form-group">
                  <label for="nisn">NISN</label>
                  <input
                    class="form-control"
                    id="nisn"
                    required=""
                    type="text"
                  />
                </div>
              </div>
              <div class="form-row">
                <div class="form-group">
                  <label for="kelas">Kelas</label>
                  <select class="form-control" id="kelas" required="">
                    <option value="">Pilih Kelas</option>
                    <option value="X">X</option>
                    <option value="XI">XI</option>
                    <option value="XII">XII</option>
                  </select>
                </div>
                <div class="form-group">
                  <label for="hp">Nomor HP Orang Tua</label>
                  <input class="form-control" id="hp" required="" type="tel" />
                </div>
              </div>
              <div class="form-group">
                <label for="alamat">Alamat Domisili</label>
                <textarea
                  class="form-control"
                  id="alamat"
                  required=""
                  rows="3"
                ></textarea>
              </div>
              <div class="form-row">
                <div class="form-group">
                  <label for="nilai">Nilai Semester 1</label>
                  <input
                    class="form-control"
                    id="nilai"
                    max="100"
                    min="0"
                    required=""
                    type="number"
                  />
                </div>
                <div class="form-group">
                  <label for="bukti-pdf">Bukti Diterima (PDF)</label>
                  <div class="file-upload" id="bukti-upload-area">
                    <i class="fas fa-file-pdf"></i>
                    <p>Drag &amp; drop file PDF atau klik untuk memilih</p>
                    <p
                      class="text-muted"
                      style="font-size: 13px; margin-top: 5px"
                    >
                      Ukuran maksimal 5MB
                    </p>
                    <input
                      accept=".pdf"
                      class="form-control"
                      id="bukti-pdf"
                      required=""
                      style="display: none"
                      type="file"
                    />
                  </div>
                  <div class="file-preview" id="bukti-preview">
                    <a href="#" id="bukti-link" target="_blank">
                      <i class="fas fa-file-pdf"></i> Bukti_Diterima.pdf
                    </a>
                  </div>
                </div>
              </div>
              <div class="form-group">
                <label for="rekomendasi-pdf"
                  >Surat Rekomendasi (Opsional)</label
                >
                <div class="file-upload" id="rekomendasi-upload-area">
                  <i class="fas fa-file-alt"></i>
                  <p>
                    Drag &amp; drop file PDF atau klik untuk memilih (Opsional)
                  </p>
                  <p
                    class="text-muted"
                    style="font-size: 13px; margin-top: 5px"
                  >
                    Ukuran maksimal 5MB
                  </p>
                  <input
                    accept=".pdf"
                    class="form-control"
                    id="rekomendasi-pdf"
                    style="display: none"
                    type="file"
                  />
                </div>
                <div class="file-preview" id="rekomendasi-preview">
                  <a href="#" id="rekomendasi-link" target="_blank">
                    <i class="fas fa-file-pdf"></i> Surat_Rekomendasi.pdf
                  </a>
                </div>
              </div>
              <div class="form-row" style="margin-top: 10px">
                <div class="form-group" style="margin-bottom: 0">
                  <button class="btn btn-primary" id="submit-btn" type="submit">
                    <i class="fas fa-save"></i> Simpan Data Siswa
                  </button>
                </div>
                <div class="form-group" style="margin-bottom: 0">
                  <button
                    class="btn btn-secondary"
                    id="cancel-edit-btn"
                    style="display: none"
                    type="button"
                  >
                    <i class="fas fa-times"></i> Batal Edit
                  </button>
                </div>
              </div>
            </form>
          </div>
        </div>
        <!-- Data Siswa Section -->
        <div class="section" id="data-siswa">
          <div class="card">
            <div class="card-header">
              <h2 class="card-title">
                <i class="fas fa-table"></i> Data Siswa
              </h2>
            </div>
            <div class="table-responsive">
              <table id="students-table">
                <thead>
                  <tr>
                    <th>Nama</th>
                    <th>NISN</th>
                    <th>Kelas</th>
                    <th>No HP</th>
                    <th>Nilai</th>
                    <th>Dokumen</th>
                    <th>Aksi</th>
                  </tr>
                </thead>
                <tbody id="students-body">
                  <!-- Data will be populated here -->
                </tbody>
              </table>
            </div>
          </div>
        </div>
        <!-- Laporan Section -->
        <div class="section" id="laporan">
          <div class="card">
            <div class="card-header">
              <h2 class="card-title">
                <i class="fas fa-chart-bar"></i> Laporan PKDS
              </h2>
            </div>
            <div class="stats-cards">
              <div class="stat-card">
                <div class="stat-content">
                  <h3>Total Siswa</h3>
                  <p id="laporan-total">0</p>
                </div>
                <i class="fas fa-users"></i>
              </div>
              <div class="stat-card">
                <div class="stat-content">
                  <h3>Data Lengkap</h3>
                  <p id="laporan-lengkap">0</p>
                </div>
                <i class="fas fa-check-circle"></i>
              </div>
              <div class="stat-card">
                <div class="stat-content">
                  <h3>Data Tidak Lengkap</h3>
                  <p id="laporan-tidak-lengkap">0</p>
                </div>
                <i class="fas fa-exclamation-circle"></i>
              </div>
            </div>
            <div class="card">
              <div class="card-header">
                <h3 class="card-title">
                  <i class="fas fa-chart-pie"></i> Grafik Kelengkapan Data
                </h3>
              </div>
              <div class="chart-container">
                <canvas id="report-chart"></canvas>
              </div>
            </div>
            <div class="report-actions">
              <button class="btn btn-success" id="download-report-btn">
                <i class="fas fa-download"></i> Download Laporan PDF
              </button>
              <button class="btn btn-primary" id="print-report-btn">
                <i class="fas fa-print"></i> Cetak Laporan
              </button>
            </div>
          </div>
        </div>
        <!-- Pengaturan Section -->
        <div class="section" id="pengaturan">
          <div class="card">
            <div class="card-header">
              <h2 class="card-title">
                <i class="fas fa-cog"></i> Pengaturan Sistem
              </h2>
            </div>
            <div class="form-group">
              <label for="batas-waktu-setting"
                >Batas Waktu Pengisian Data</label
              >
              <input
                class="form-control"
                id="batas-waktu-setting"
                required=""
                type="date"
              />
              <small class="text-muted"
                >Atur tanggal penutupan sistem PKDS</small
              >
            </div>
            <div class="form-row">
              <div class="form-group">
                <label for="new-password">Password Baru</label>
                <input
                  class="form-control"
                  id="new-password"
                  placeholder="Masukkan password baru"
                  type="password"
                />
              </div>
              <div class="form-group">
                <label for="confirm-password">Konfirmasi Password</label>
                <input
                  class="form-control"
                  id="confirm-password"
                  placeholder="Konfirmasi password baru"
                  type="password"
                />
              </div>
            </div>
            <button class="btn btn-primary" id="save-settings-btn">
              <i class="fas fa-save"></i> Simpan Pengaturan
            </button>
            <div
              style="
                margin-top: 25px;
                padding-top: 20px;
                border-top: 1px solid var(--gray);
              "
            >
              <h3 style="margin-bottom: 15px; color: var(--danger)">
                <i class="fas fa-exclamation-triangle"></i> Reset Data
              </h3>
              <p style="margin-bottom: 15px">
                Reset akan menghapus semua data siswa yang tersimpan. Tindakan
                ini tidak dapat dibatalkan.
              </p>
              <button class="btn btn-danger" id="reset-data-btn">
                <i class="fas fa-trash"></i> Reset Data Siswa
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
    <script>
      // Global variable to track edit mode
      let isEditMode = false;
      let currentEditId = null;

      // Initialize application
      document.addEventListener("DOMContentLoaded", function () {
        // Check if emergency access is enabled
        const emergencyAccess = localStorage.getItem("emergencyAccess");
        if (emergencyAccess) {
          const accessDate = new Date(parseInt(emergencyAccess));
          const now = new Date();
          const diffTime = Math.abs(now - accessDate);
          const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));

          if (diffDays > 7) {
            localStorage.removeItem("emergencyAccess");
          }
        }

        // Check if user is logged in
        if (localStorage.getItem("isLoggedIn") === "true") {
          showApp();
        }

        // Initialize file upload areas
        initializeFileUploads();

        // Login functionality
        document
          .getElementById("login-btn")
          .addEventListener("click", function () {
            handleLogin();
          });

        document
          .getElementById("emergency-login-btn")
          .addEventListener("click", function () {
            handleEmergencyLogin();
          });

        // Logout functionality
        document
          .getElementById("logout-btn")
          .addEventListener("click", function () {
            localStorage.removeItem("isLoggedIn");
            document.getElementById("login-section").style.display = "block";
            document.getElementById("app").style.display = "none";
            document.getElementById("username").value = "";
            document.getElementById("password").value = "";
          });

        // Close modal
        document
          .getElementById("close-preview-modal")
          .addEventListener("click", function () {
            document.getElementById("preview-modal").classList.remove("active");
          });

        // Navigation
        document.querySelectorAll(".menu-link").forEach((link) => {
          link.addEventListener("click", function (e) {
            e.preventDefault();
            document
              .querySelectorAll(".menu-link")
              .forEach((l) => l.classList.remove("active"));
            this.classList.add("active");
            const sectionId = this.getAttribute("data-section");
            showSection(sectionId);
          });
        });

        // Form submission
        document
          .getElementById("student-form")
          .addEventListener("submit", function (e) {
            e.preventDefault();
            saveStudentData();
          });

        // Cancel edit
        document
          .getElementById("cancel-edit-btn")
          .addEventListener("click", function () {
            resetForm();
          });

        // Back to list
        document
          .getElementById("back-to-list-btn")
          .addEventListener("click", function () {
            resetForm();
            showSection("data-siswa");
          });

        // Settings save
        document
          .getElementById("save-settings-btn")
          .addEventListener("click", function () {
            saveSettings();
          });

        // Reset data
        document
          .getElementById("reset-data-btn")
          .addEventListener("click", function () {
            resetAllData();
          });

        // Download report
        document
          .getElementById("download-report-btn")
          .addEventListener("click", generatePDFReport);

        document
          .getElementById("print-report-btn")
          .addEventListener("click", function () {
            window.print();
          });

        // Header scroll effect
        window.addEventListener("scroll", function () {
          const header = document.querySelector(".header");
          if (window.scrollY > 50) {
            header.classList.add("scrolled");
          } else {
            header.classList.remove("scrolled");
          }
        });

        // Initialize
        setupDateRestrictions();
        updateDeadlineDisplay();
        renderStudentsTable();
        updateDashboardStats();
        initReportChart();
      });

      // Initialize file upload areas
      function initializeFileUploads() {
        document
          .getElementById("bukti-upload-area")
          .addEventListener("click", function () {
            document.getElementById("bukti-pdf").click();
          });

        document
          .getElementById("rekomendasi-upload-area")
          .addEventListener("click", function () {
            document.getElementById("rekomendasi-pdf").click();
          });

        document
          .getElementById("bukti-pdf")
          .addEventListener("change", function (e) {
            previewFile(e, "bukti-preview", "bukti-link");
          });

        document
          .getElementById("rekomendasi-pdf")
          .addEventListener("change", function (e) {
            previewFile(e, "rekomendasi-preview", "rekomendasi-link");
          });
      }

      // Setup date restrictions for login
      function setupDateRestrictions() {
        const startDate = new Date(2025, 10, 7); // November 7, 2025 (months are 0-indexed)
        const endDate = new Date(2025, 10, 30); // November 30, 2025
        const today = new Date();

        // Set min and max for batas waktu setting
        const batasWaktuSetting = document.getElementById(
          "batas-waktu-setting"
        );
        batasWaktuSetting.min = startDate.toISOString().split("T")[0];
        batasWaktuSetting.max = new Date(2026, 0, 31)
          .toISOString()
          .split("T")[0];

        // Set default batas waktu if not exists
        if (!localStorage.getItem("batasWaktu")) {
          localStorage.setItem(
            "batasWaktu",
            endDate.toISOString().split("T")[0]
          );
        }
      }

      // Handle regular login
      function handleLogin() {
        const username = document.getElementById("username").value;
        const password = document.getElementById("password").value;
        const errorMessage = document.getElementById("error-message");

        const startDate = new Date(2025, 10, 7); // November 7, 2025
        const endDate = new Date(2025, 10, 30); // November 30, 2025
        const today = new Date();

        // Reset time components for accurate date comparison
        today.setHours(0, 0, 0, 0);
        startDate.setHours(0, 0, 0, 0);
        endDate.setHours(0, 0, 0, 0);

        // Check if within allowed date range
        if (today < startDate || today > endDate) {
          // Check if emergency access is enabled
          const emergencyAccess = localStorage.getItem("emergencyAccess");
          if (!emergencyAccess) {
            errorMessage.textContent =
              "Periode penginputan PKDS telah ditutup. Silakan gunakan login darurat.";
            errorMessage.style.display = "block";

            setTimeout(() => {
              errorMessage.style.display = "none";
            }, 5000);
            return;
          } else {
            const accessDate = new Date(parseInt(emergencyAccess));
            const now = new Date();
            const diffTime = Math.abs(now - accessDate);
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));

            if (diffDays > 7) {
              localStorage.removeItem("emergencyAccess");
              errorMessage.textContent =
                "Akses darurat telah kadaluarsa. Silakan upload file bukti baru.";
              errorMessage.style.display = "block";

              setTimeout(() => {
                errorMessage.style.display = "none";
              }, 5000);
              return;
            }
          }
        }

        // Check credentials
        if (username === "administrator" && password === "maluku#1") {
          localStorage.setItem("isLoggedIn", "true");
          showApp();
        } else {
          errorMessage.style.display = "block";
          setTimeout(() => {
            errorMessage.style.display = "none";
          }, 3000);
        }
      }

      // Handle emergency login
      function handleEmergencyLogin() {
        const emergencyFile =
          document.getElementById("emergency-file").files[0];
        const errorMessage = document.getElementById("error-message");

        if (!emergencyFile) {
          errorMessage.textContent =
            "Silakan upload file bukti darurat terlebih dahulu!";
          errorMessage.style.display = "block";

          setTimeout(() => {
            errorMessage.style.display = "none";
          }, 3000);
          return;
        }

        // Check file type
        if (emergencyFile.type !== "application/pdf") {
          errorMessage.textContent = "File harus berformat PDF!";
          errorMessage.style.display = "block";

          setTimeout(() => {
            errorMessage.style.display = "none";
          }, 3000);
          return;
        }

        // In a real system, we would verify the emergency file
        // For this demo, we'll just allow access for 7 days
        localStorage.setItem("emergencyAccess", Date.now().toString());
        localStorage.setItem("isLoggedIn", "true");
        showApp();

        showNotification(
          "Akses darurat berhasil diaktifkan! Berlaku selama 7 hari.",
          "success"
        );
      }

      // Show application
      function showApp() {
        document.getElementById("login-section").style.display = "none";
        document.getElementById("app").style.display = "flex";
        showSection("dashboard");
      }

      // Show specific section
      function showSection(sectionId) {
        document.querySelectorAll(".section").forEach((section) => {
          section.classList.remove("active");
        });
        document.getElementById(sectionId).classList.add("active");
      }

      // Update deadline display
      function updateDeadlineDisplay() {
        const batasWaktu = localStorage.getItem("batasWaktu") || "2025-11-30";
        const date = new Date(batasWaktu);
        const options = { year: "numeric", month: "long", day: "numeric" };
        const formattedDate = date.toLocaleDateString("id-ID", options);

        document.getElementById("batas-waktu").textContent = formattedDate;
        document.getElementById("batas-waktu-setting").value = batasWaktu;
      }

      // Show notification
      function showNotification(message, type) {
        const notification = document.getElementById(
          type === "success" ? "success-notification" : "error-notification"
        );
        notification.querySelector("span").textContent = message;
        notification.classList.add("show");

        setTimeout(() => {
          notification.classList.remove("show");
        }, 3000);
      }

      // Save student data
      function saveStudentData() {
        const nama = document.getElementById("nama").value;
        const nisn = document.getElementById("nisn").value;
        const kelas = document.getElementById("kelas").value;
        const hp = document.getElementById("hp").value;
        const alamat = document.getElementById("alamat").value;
        const nilai = document.getElementById("nilai").value;
        const buktiPDF = document.getElementById("bukti-pdf").files[0];
        const rekomendasiPDF =
          document.getElementById("rekomendasi-pdf").files[0];
        const editId = document.getElementById("edit-id").value;

        // Validate required fields - note that rekomendasiPDF is NOT required
        if (
          !nama ||
          !nisn ||
          !kelas ||
          !hp ||
          !alamat ||
          !nilai ||
          (!buktiPDF && !editId)
        ) {
          showNotification(
            "Silakan lengkapi field wajib (Surat Rekomendasi opsional)",
            "error"
          );
          return;
        }

        // Read PDF files as base64
        let buktiBase64 = null;
        let rekomendasiBase64 = null;
        let filesProcessed = 0;
        let totalFiles = 1; // Bukti PDF is required, Rekomendasi is optional

        // If editing and no new bukti file selected, keep the old one
        const students = JSON.parse(localStorage.getItem("students") || "[]");

        if (editId) {
          const existingStudent = students.find((s) => s.id == editId);
          if (existingStudent && !buktiPDF) {
            buktiBase64 = existingStudent.buktiPDF;
            filesProcessed++;
          } else if (buktiPDF) {
            totalFiles = rekomendasiPDF ? 2 : 1;
          }

          if (existingStudent && rekomendasiPDF) {
            totalFiles = rekomendasiPDF ? 2 : 1;
          } else if (rekomendasiPDF) {
            totalFiles = rekomendasiPDF ? 2 : 1;
          }
        } else {
          totalFiles = rekomendasiPDF ? 2 : 1;
        }

        // Process bukti PDF if available
        if (buktiPDF) {
          const readerBukti = new FileReader();
          readerBukti.onload = function () {
            buktiBase64 = readerBukti.result.split(",")[1]; // Get base64 part
            filesProcessed++;
            checkIfReady();
          };
          readerBukti.readAsDataURL(buktiPDF);
        } else if (editId) {
          // If editing and no new file, use existing file
          const existingStudent = students.find((s) => s.id == editId);
          if (existingStudent) {
            buktiBase64 = existingStudent.buktiPDF;
            filesProcessed++;
          }
        }

        // Process rekomendasi PDF if available (optional)
        if (rekomendasiPDF) {
          let totalFiles = 1; // Rekomendasi benar-benar opsional
          const readerRekomendasi = new FileReader();
          readerRekomendasi.onload = function () {
            rekomendasiBase64 = readerRekomendasi.result.split(",")[1];
            filesProcessed++;
            checkIfReady();
          };
          readerRekomendasi.readAsDataURL(rekomendasiPDF);
        } else {
          // Jika rekomendasi tidak diupload, langsung lanjut tanpa memblokir
          checkIfReady();
        }

        function checkIfReady() {
          if (filesProcessed === totalFiles) {
            let students = JSON.parse(localStorage.getItem("students") || "[]");

            const studentData = {
              nama,
              nisn,
              kelas,
              hp,
              alamat,
              nilai,
              buktiPDF: buktiBase64,
              rekomendasiPDF: rekomendasiBase64, // Bisa null jika tidak diisi
              tanggal: new Date().toISOString(),
            };

            if (editId) {
              // Update existing student
              const index = students.findIndex((s) => s.id == editId);
              if (index !== -1) {
                studentData.id = parseInt(editId);
                students[index] = studentData;
              }
            } else {
              // Add new student
              studentData.id = Date.now();
              students.push(studentData);
            }

            localStorage.setItem("students", JSON.stringify(students));

            // Reset form
            resetForm();

            // Update UI
            renderStudentsTable();
            updateDashboardStats();

            // Show notification
            showNotification(
              editId
                ? "Data siswa berhasil diperbarui!"
                : "Data siswa berhasil disimpan!",
              "success"
            );

            // Navigate to data siswa if not in edit mode
            if (!editId) {
              showSection("data-siswa");
            }
          }
        }

        // If no files to process (shouldn't happen with validation)
        if (totalFiles === 0) {
          checkIfReady();
        }
      }

      // Reset form
      function resetForm() {
        document.getElementById("student-form").reset();
        document.getElementById("edit-id").value = "";
        document.getElementById("bukti-preview").classList.remove("show");
        document.getElementById("rekomendasi-preview").classList.remove("show");
        document.getElementById("form-title").innerHTML =
          '<i class="fas fa-edit"></i> Input Data Siswa';
        document.getElementById("submit-btn").innerHTML =
          '<i class="fas fa-save"></i> Simpan Data Siswa';
        document.getElementById("cancel-edit-btn").style.display = "none";
        document.getElementById("back-to-list-btn").style.display = "none";
        isEditMode = false;
        currentEditId = null;
      }

      // Preview file
      function previewFile(event, previewId, linkId) {
        const file = event.target.files[0];
        if (!file) return;

        const preview = document.getElementById(previewId);
        const link = document.getElementById(linkId);

        link.innerHTML = `<i class="fas fa-file-pdf"></i> ${file.name}`;
        preview.classList.add("show");
      }

      // Render students table
      function renderStudentsTable() {
        const students = JSON.parse(localStorage.getItem("students") || "[]");
        const tbody = document.getElementById("students-body");
        tbody.innerHTML = "";

        if (students.length === 0) {
          tbody.innerHTML = `
                    <tr>
                        <td colspan="7" style="text-align: center; padding: 30px; color: #6c757d;">
                            <i class="fas fa-inbox" style="font-size: 48px; margin-bottom: 15px;"></i>
                            <p>Belum ada data siswa yang tersimpan</p>
                            <button class="btn btn-primary" style="margin-top: 15px;" onclick="showSection('input-data')">
                                <i class="fas fa-plus"></i> Tambah Data Siswa
                            </button>
                        </td>
                    </tr>
                `;
          return;
        }

        students.forEach((student) => {
          const row = document.createElement("tr");
          row.innerHTML = `
                    <td><strong>${student.nama}</strong></td>
                    <td>${student.nisn}</td>
                    <td><span class="badge" style="background: #e3f2fd; color: var(--primary); padding: 3px 8px; border-radius: 12px;">${
                      student.kelas
                    }</span></td>
                    <td>${student.hp}</td>
                    <td><span style="color: ${
                      student.nilai >= 75 ? "var(--success)" : "var(--danger)"
                    }; font-weight: 600;">${student.nilai}</span></td>
                    <td>
                        ${
                          student.buktiPDF
                            ? `
                            <button class="btn-action btn-preview" onclick="viewPDF('${student.buktiPDF}', 'Bukti Diterima - ${student.nama}')">
                                <i class="fas fa-eye"></i> Bukti
                            </button>
                        `
                            : '<span class="text-muted">Tidak ada</span>'
                        }
                        ${
                          student.rekomendasiPDF
                            ? `
                            <button class="btn-action btn-preview" onclick="viewPDF('${student.rekomendasiPDF}', 'Surat Rekomendasi - ${student.nama}')">
                                <i class="fas fa-eye"></i> Rekom
                            </button>
                        `
                            : '<span class="text-muted">Opsional</span>'
                        }
                    </td>
                    <td>
                        <button class="btn-action btn-edit" onclick="editStudent(${
                          student.id
                        })">
                            <i class="fas fa-edit"></i> Edit
                        </button>
                        <button class="btn-action btn-delete" onclick="deleteStudent(${
                          student.id
                        })">
                            <i class="fas fa-trash"></i> Hapus
                        </button>
                    </td>
                `;
          tbody.appendChild(row);
        });
      }

      // View PDF in new tab
      function viewPDF(base64, title) {
        const byteCharacters = atob(base64);
        const byteNumbers = new Array(byteCharacters.length);
        for (let i = 0; i < byteCharacters.length; i++) {
          byteNumbers[i] = byteCharacters.charCodeAt(i);
        }
        const byteArray = new Uint8Array(byteNumbers);
        const file = new Blob([byteArray], { type: "application/pdf" });
        const fileURL = URL.createObjectURL(file);

        const newWindow = window.open();
        newWindow.document.write(`
                <html>
                    <head>
                        <title>${title}</title>
                        <style>
                            body { margin: 0; padding: 0; }
                            iframe { width: 100%; height: 100vh; border: none; }
                        </style>
                    </head>
                    <body>
                        <iframe src="${fileURL}"></iframe>
                    </body>
                </html>
            `);
      }

      // Edit student
      function editStudent(id) {
        const students = JSON.parse(localStorage.getItem("students") || "[]");
        const student = students.find((s) => s.id == id);

        if (!student) return;

        // Fill form with student data
        document.getElementById("edit-id").value = student.id;
        document.getElementById("nama").value = student.nama;
        document.getElementById("nisn").value = student.nisn;
        document.getElementById("kelas").value = student.kelas;
        document.getElementById("hp").value = student.hp;
        document.getElementById("alamat").value = student.alamat;
        document.getElementById("nilai").value = student.nilai;

        // Update form UI
        document.getElementById("form-title").innerHTML =
          '<i class="fas fa-edit"></i> Edit Data Siswa';
        document.getElementById("submit-btn").innerHTML =
          '<i class="fas fa-sync-alt"></i> Update Data Siswa';
        document.getElementById("cancel-edit-btn").style.display = "block";
        document.getElementById("back-to-list-btn").style.display = "block";
        isEditMode = true;
        currentEditId = id;

        // Show file previews
        if (student.buktiPDF) {
          document.getElementById("bukti-preview").classList.add("show");
          document.getElementById("bukti-link").innerHTML =
            '<i class="fas fa-file-pdf"></i> Bukti_Diterima.pdf';
        }

        if (student.rekomendasiPDF) {
          document.getElementById("rekomendasi-preview").classList.add("show");
          document.getElementById("rekomendasi-link").innerHTML =
            '<i class="fas fa-file-pdf"></i> Surat_Rekomendasi.pdf';
        } else {
          // Clear preview if no file
          document
            .getElementById("rekomendasi-preview")
            .classList.remove("show");
        }

        // Show form section
        showSection("input-data");

        // Scroll to form
        document.querySelector(".content").scrollTo({
          top: 0,
          behavior: "smooth",
        });
      }

      // Delete student
      function deleteStudent(id) {
        if (
          confirm(
            "Anda yakin ingin menghapus data siswa ini? Tindakan ini tidak dapat dibatalkan!"
          )
        ) {
          let students = JSON.parse(localStorage.getItem("students") || "[]");
          students = students.filter((student) => student.id !== id);
          localStorage.setItem("students", JSON.stringify(students));

          renderStudentsTable();
          updateDashboardStats();
          showNotification("Data siswa berhasil dihapus!", "success");
        }
      }

      // Update dashboard stats
      function updateDashboardStats() {
        const students = JSON.parse(localStorage.getItem("students") || "[]");
        document.getElementById("total-siswa").textContent = students.length;
        document.getElementById("pkds-terekam").textContent = students.length;
        document.getElementById("laporan-total").textContent = students.length;
        document.getElementById("laporan-lengkap").textContent =
          students.length;
        document.getElementById("laporan-tidak-lengkap").textContent = "0";

        // Update activity log
        const activityList = document.getElementById("activity-list");
        if (students.length > 0) {
          const latestStudent = students[students.length - 1];
          const date = new Date(latestStudent.tanggal);
          const formattedDate = date.toLocaleDateString("id-ID", {
            day: "numeric",
            month: "long",
            year: "numeric",
            hour: "2-digit",
            minute: "2-digit",
          });

          activityList.innerHTML = `
                    <div class="activity-item">
                        <div class="activity-icon">
                            <i class="fas fa-user-plus"></i>
                        </div>
                        <div class="activity-content">
                            <h4>Penambahan Data Siswa</h4>
                            <p>Data untuk ${
                              latestStudent.nama
                            } berhasil disimpan</p>
                            <time>${formattedDate}</time>
                        </div>
                    </div>
                    <div class="activity-item">
                        <div class="activity-icon">
                            <i class="fas fa-file-upload"></i>
                        </div>
                        <div class="activity-content">
                            <h4>Unggah Dokumen</h4>
                            <p>Bukti diterima dan surat rekomendasi diunggah</p>
                            <time>${formattedDate}</time>
                        </div>
                    </div>
                    <div class="activity-item">
                        <div class="activity-icon">
                            <i class="fas fa-database"></i>
                        </div>
                        <div class="activity-content">
                            <h4>Pembaruan Database</h4>
                            <p>Total ${
                              students.length
                            } siswa tercatat dalam sistem</p>
                            <time>${new Date().toLocaleDateString(
                              "id-ID"
                            )}</time>
                        </div>
                    </div>
                `;
        }
      }

      // Initialize report chart
      function initReportChart() {
        const ctx = document.getElementById("report-chart").getContext("2d");
        new Chart(ctx, {
          type: "doughnut",
          data: {
            labels: ["Data Lengkap", "Data Tidak Lengkap"],
            datasets: [
              {
                data: [100, 0],
                backgroundColor: [
                  "rgba(40, 167, 69, 0.85)",
                  "rgba(220, 53, 69, 0.85)",
                ],
                borderWidth: 0,
                borderColor: ["rgba(40, 167, 69, 1)", "rgba(220, 53, 69, 1)"],
              },
            ],
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: {
                position: "bottom",
                labels: {
                  padding: 20,
                  font: {
                    size: 14,
                  },
                },
              },
              tooltip: {
                backgroundColor: "rgba(0, 0, 0, 0.7)",
                titleFont: {
                  size: 16,
                },
                bodyFont: {
                  size: 14,
                },
                padding: 12,
                displayColors: true,
              },
            },
            cutout: "65%",
          },
        });
      }

      // Save settings
      function saveSettings() {
        const batasWaktu = document.getElementById("batas-waktu-setting").value;
        const newPassword = document.getElementById("new-password").value;
        const confirmPass = document.getElementById("confirm-password").value;

        if (newPassword && newPassword !== confirmPass) {
          showNotification(
            "Password baru dan konfirmasi tidak cocok!",
            "error"
          );
          return;
        }

        // Save deadline
        if (batasWaktu) {
          localStorage.setItem("batasWaktu", batasWaktu);
          updateDeadlineDisplay();
          showNotification(
            "Pengaturan batas waktu berhasil disimpan",
            "success"
          );
        }

        // Save password (for demo purposes only)
        if (newPassword) {
          localStorage.setItem("adminPassword", newPassword);
          showNotification("Password berhasil diubah!", "success");
        }

        // Clear form
        document.getElementById("new-password").value = "";
        document.getElementById("confirm-password").value = "";
      }

      // Reset all data
      function resetAllData() {
        if (
          confirm(
            "Anda yakin ingin menghapus semua data siswa? Tindakan ini tidak dapat dibatalkan!"
          )
        ) {
          localStorage.removeItem("students");
          renderStudentsTable();
          updateDashboardStats();
          showNotification("Data siswa berhasil direset!", "success");
        }
      }

      // Generate PDF report
      function generatePDFReport() {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();

        // Add header
        doc.setFontSize(22);
        doc.setFont("helvetica", "bold");
        doc.setTextColor(26, 109, 204);
        doc.text("LAPORAN PKDS", 105, 20, null, null, "center");

        doc.setFontSize(14);
        doc.setFont("helvetica", "normal");
        doc.setTextColor(108, 117, 125);
        doc.text(
          "Sistem Pengelolaan Data Siswa - SMAN 3 Bulukumba",
          105,
          30,
          null,
          null,
          "center"
        );

        // Add line separator
        doc.setDrawColor(26, 109, 204);
        doc.setLineWidth(0.5);
        doc.line(20, 35, 190, 35);

        // Add stats
        doc.setFontSize(18);
        doc.setFont("helvetica", "bold");
        doc.setTextColor(44, 62, 80);
        doc.text("Rekap Data Siswa", 20, 50);

        doc.setFontSize(12);
        doc.setFont("helvetica", "normal");
        doc.setTextColor(60, 60, 60);

        const total = document.getElementById("laporan-total").textContent;
        const lengkap = document.getElementById("laporan-lengkap").textContent;
        const tidakLengkap = document.getElementById(
          "laporan-tidak-lengkap"
        ).textContent;

        doc.text(`Total Siswa: ${total}`, 25, 65);
        doc.text(`Data Lengkap: ${lengkap}`, 25, 75);
        doc.text(`Data Tidak Lengkap: ${tidakLengkap}`, 25, 85);

        // Add date
        const today = new Date();
        doc.text(
          `Tanggal Laporan: ${today.toLocaleDateString("id-ID")}`,
          150,
          65,
          null,
          null,
          "right"
        );

        // Add table header
        doc.setFontSize(14);
        doc.setFont("helvetica", "bold");
        doc.text("Daftar Siswa", 20, 105);

        // Draw table header
        doc.setFillColor(26, 109, 204);
        doc.setTextColor(255, 255, 255);
        doc.rect(20, 110, 170, 8, "F");

        doc.setFontSize(10);
        doc.setTextColor(255, 255, 255);
        doc.text("No", 25, 116);
        doc.text("Nama Siswa", 45, 116);
        doc.text("NISN", 90, 116);
        doc.text("Kelas", 120, 116);
        doc.text("Nilai", 140, 116);
        doc.text("Status", 160, 116);

        // Draw table data
        const students = JSON.parse(localStorage.getItem("students") || "[]");
        let yPos = 122;
        doc.setTextColor(60, 60, 60);

        students.forEach((student, index) => {
          if (yPos > 280) {
            doc.addPage();
            yPos = 20;
          }

          doc.setFontSize(10);
          doc.text(`${index + 1}`, 25, yPos);
          doc.text(student.nama.substring(0, 25), 45, yPos);
          doc.text(student.nisn, 90, yPos);
          doc.text(student.kelas, 120, yPos);
          doc.text(student.nilai, 140, yPos);
          doc.text("Lengkap", 160, yPos);

          yPos += 8;
        });

        // Add footer
        doc.setFontSize(10);
        doc.setTextColor(150, 150, 150);
        doc.text(
          "Laporan ini dibuat secara otomatis melalui sistem PKDS",
          105,
          290,
          null,
          null,
          "center"
        );

        // Save the PDF
        doc.save(
          `laporan-pkds-${today.getDate()}-${
            today.getMonth() + 1
          }-${today.getFullYear()}.pdf`
        );

        showNotification("Laporan PDF berhasil diunduh!", "success");
      }
    </script>
  </body>
</html>
